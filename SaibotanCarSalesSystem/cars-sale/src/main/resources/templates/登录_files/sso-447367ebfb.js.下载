"use strict";var gCaptchaObj,formFlag=!0,Geetest_flag=!1,SSO={errorTipsShow:function(e){$(".error-tips").html(e).show(),setTimeout(function(){$(".error-tips").html("").hide()},3e3)},ajaxCaptchaImg:function(e){var t=(new Date).getTime();e.attr("src","/sso/api/sendchartcode?t = "+t)},showErrors:function(e){var t=$(".error-tips").find("label").html();$(".error-tips label:hidden").remove(),$(".error-tips label:eq(0)").nextAll().remove(),t&&setTimeout(function(){$(".error-tips").html("").hide(),e.attr("disabled",!1).addClass("btn-normal").removeClass("sso-disabled")},3e3)},blurInput:function(e){if(0<=e.val().indexOf(" ")){SSO.errorTipsShow("<label>密码不可包含空格</label>")}},determineBrowser:function(){var e=navigator.userAgent;return/(iPhone|iPod|Android|ios)/i.test(e)?"wap":"web"},resetGeetest:function(e,t,a){$(".touch-tab .geetest-login").html(""),$(".geetest_goto").remove()},resetForm:function(){$(":input",".touch-inp-con form",".J-tabs-content form").not(":button, :submit, :reset, :hidden").val("").removeAttr("checked").removeAttr("selected")},ajaxGeetest:function(a,e,s){var t=SSO.determineBrowser(),n=e.val();dndc.ajax({url:"/sso/api/getGeetestCaptcha?t="+(new Date).getTime()+"&browser="+t+"&accountName="+n,type:"get",dataType:"json",doneCallback:function(e){initGeetest({gt:e.gt,challenge:e.challenge,new_captcha:e.new_captcha,product:"embed",offline:!e.success},function(e){gCaptchaObj=e;var t=a.find("#embed-captcha");e.appendTo(t),e.onReady(function(){a.find("#wait").addClass("hide").removeClass("show"),s.attr("disabled",!1).addClass("btn-normal").removeClass("sso-disabled")})})}})},isNeedGeetest:function(t,a,s){var e=a.val();dndc.ajax({url:"/sso/api/isNeedShowGeekey?accountName="+e,type:"get",dataType:"json",doneCallback:function(e){0==e.code&&(0!==e.data?(Geetest_flag=!0,t.find(".J-form-item").removeClass("none"),SSO.ajaxGeetest(t,a,s)):(t.find(".J-form-item").addClass("none"),s.attr("disabled",!1).addClass("btn-normal").removeClass("sso-disabled")))}})},resetCaptcha:function(){gCaptchaObj&&gCaptchaObj.reset()},ajaxForm:function(e,a,t,s,n){formFlag=!1;dndc.ajax({url:t,type:"post",dataType:"json",data:e,doneCallback:function(e){if(0!==e.code){var t="<label>"+e.message+"</label>";SSO.errorTipsShow(t),a.attr("disabled",!1).removeClass("sso-disabled"),SSO.resetCaptcha(),formFlag=!0,0==Geetest_flag&&401!==e.code&&SSO.isNeedGeetest(s,n,a)}else{$("#userpwd").val(""),$("#userpwd").attr("type","text");t="<label>"+e.message+"</label>";SSO.errorTipsShow(t),setTimeout(function(){window.location.href=decodeURI(e.data.returnUrl)},2e3)}}})},geetestSuccess:function(e,t,a,s){e.find(".geetest_form input[name=geetest_challenge]").val()?(t.attr("disabled",!0).addClass(a).removeClass(s),e.submit()):(e.find("#notice").addClass("show").removeClass("hide"),setTimeout(function(){e.find("#notice").addClass("hide").removeClass("show")},2e3))},geetestNone:function(e,t,a,s){t.attr("disabled",!0).addClass(a).removeClass(s),e.submit()},btnClick:function(e,t,a,s){Geetest_flag?SSO.geetestSuccess(e,t,a,s):SSO.geetestNone(e,t,a,s)},dont_login:function(e,t){e.text(t);var a=setInterval(function(){t--,e.html(t),t<1&&(window.location.href=login_return_url.LoginReturnUrl,clearInterval(a))},1e3)}};$(function(){$("#sms_btn").on("click",function(){var a=$(this),e=$('input[name="userphone"]').val(),t=$('input[name="phone_captcha"]').val();if(/^\d{11}$/.test(e))if(4==t.length){disabledOpj.btnOpj=a,disabledOpj.btnText="获取验证码",disabledOpj.btnClass="smsbtn-normal",disabledOpj.disClass="smsbtn-disabled",dndc.btnDisabled(disabledOpj,1),dndc.ajax({url:"/sso/api/sendsms",type:"post",data:{mobile:function(){return $("#userphone").val()},verifyChartCode:function(){return t}},doneCallback:function(e){if(0!==e.code){var t="<label>"+e.message+"</label>";SSO.errorTipsShow(t),dndc.btnDisabled(disabledOpj,0),SSO.ajaxCaptchaImg($("#img_captcha img"))}else!function(e,t,a){e.prop("disabled",!0),e.html("重新发送("+t+"s)");var s=setInterval(function(){--t<1?(clearInterval(s),a&&a()):e.html("重新发送("+t+"s)")},1e3)}(a,120,function(){dndc.btnDisabled(disabledOpj,0)})}})}else{a.prop("disabled",!1);var s="<label>请正确填写图形验证码</label>";SSO.errorTipsShow(s),SSO.ajaxCaptchaImg($("#img_captcha img"))}else{a.prop("disabled",!1);s="<label>请正确填写您的号码</label>";SSO.errorTipsShow(s)}})});